/*!
 * @license :shivneri-ws-client - V1.0.0 - 29/03/2020
 * https://github.com/ujjwalguptaofficial/shivneri-ws-client-javascript
 * Copyright (c) 2020 @Ujjwal Gupta; Licensed APACHE 2.0
 */
var shivneriWsClient=function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";var o,r;function i(e,n){return{type:e,message:function(){switch(e){case o.InvalidUrl:return"invalid web socket url "+n;case o.NoUrlProvided:return"provide url in constructor"}}()}}t.r(n),t.d(n,"Instance",(function(){return c})),function(e){e.InvalidUrl="invalid_url",e.NoUrlProvided="no_url_provided"}(o||(o={})),function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(r||(r={}));var c=function(){function e(){this.option={pingInterval:1e4,pingTimeout:1e4},this.isConnected=!1,this.eventStore={},this.onError=function(e){},this.onConnected=function(){},this.onDisconnected=function(){}}return Object.defineProperty(e.prototype,"state",{get:function(){return this.webSocket.readyState},enumerable:!0,configurable:!0}),e.prototype.init=function(e,n){var t=this;if(this.inputUrl=e,!e)throw i(o.NoUrlProvided);return this.socketUrl=function(e){var n=e.length;return"/"===e[n-1]?e.substr(0,n-1):e}(e),Object.assign(this.option,n),new Promise((function(e,n){fetch("http://"+t.socketUrl+"/info").then((function(r){r.ok?t.establishWebSocketConnection().then(e).catch(n):n(i(o.InvalidUrl,t.socketUrl))})).catch((function(e){n(i(o.InvalidUrl,t.inputUrl))}))}))},e.prototype.close=function(e){var n=this;return new Promise((function(t){if(n.isConnected){n.webSocket.close(1e3,e||"Manually closing");var o=function(){setTimeout((function(){n.isConnected?o():t()}),100)};o()}else t()}))},e.prototype.on=function(e,n){"function"==typeof n?this.eventStore[e]=n:console.warn("invalid event handler for event "+e)},e.prototype.emit=function(e,n){n={dataType:typeof n,data:n||null,eventName:e},this.webSocket.send(JSON.stringify(n))},e.prototype.sendPing=function(){var e=this;setTimeout((function(){e.state===r.OPEN&&(e.emit("ping","ping"),e.waitForPong())}),this.option.pingInterval)},e.prototype.waitForPong=function(){var e=this;this.pongTimer=setTimeout((function(){e.close("pong not received within speified time")}),this.option.pingTimeout)},e.prototype.establishWebSocketConnection=function(){var e=this;return new Promise((function(n){e.webSocket=new WebSocket("ws://"+e.socketUrl),e.webSocket.onopen=function(t){e.isConnected=!0,e.onConnected(),n(),e.sendPing()},e.webSocket.onclose=function(n){e.isConnected=!1,window.removeEventListener("offline",e.onOffline),e.onDisconnected()},e.webSocket.onmessage=function(n){var t=JSON.parse(n.data);if(e.eventStore[t.event_name])e.eventStore[t.event_name](function(e){switch(e.data_type){case"string":return e.data;case"number":return Number(e.data);case"json":return JSON.parse(e.data);case"bool":case"boolean":return"true"===e.data}return e.data}(t));else switch(t.event_name){case"pong":clearTimeout(e.pongTimer),e.sendPing();break;case"ping":e.emit("pong","pong");break;case"error":e.onError({data:t.data})}},e.webSocket.onerror=e.onError,window.addEventListener("offline",e.onOffline)}))},e.prototype.onOffline=function(){this.close("offline detected")},e}()}]);
//# sourceMappingURL=shivneri-ws-client.min.js.map